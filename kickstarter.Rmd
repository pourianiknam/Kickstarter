---
title: "Kickstarter"
author: "Pouria Niknam"
date: "5/9/2020"str
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE,echo=FALSE,warning=FALSE}
library(dplyr)
library(readr)
library(lubridate)
library(stringr)
```

```{r, eval=FALSE}
kickstart <- list.files(path="C:\\Users\\Pouria\\OneDrive - UWGB\\Documents\\Kickstarter", full.names = TRUE) %>% 
  lapply(read_csv) %>% 
  bind_rows
```
```{r, eval=FALSE}
write_csv(kickstart,pa th="C:\\Users\\Pouria\\OneDrive - UWGB\\Documents\\Kickstarter.csv")
```
```{r, message=FALSE,echo=FALSE,warning=FALSE,eval=FALSE}
kickstart <- read_csv("C:\\Users\\Pouria\\OneDrive - UWGB\\Documents\\Kickstarter.csv")
```

```{r, message=FALSE,echo=FALSE,warning=FALSE,eval=FALSE}
set.seed(2, sample.kind = "Rounding")
n = dim(kickstart[1])
sample.list <- sample.int(n, size = 5000, replace = FALSE)
ks.sample <- kickstart[sample.list,]
```
```{r, eval=FALSE}
write_csv(ks.sample,path="C:\\Users\\Pouria\\OneDrive - UWGB\\Documents\\ks.sample.csv")
```

```{r, message=FALSE,echo=FALSE,warning=FALSE}
ks.sample <- read_csv("C:\\Users\\Pouria\\OneDrive - UWGB\\Documents\\ks.sample.csv")
```

```{r}
ks.sample$deadline <- as_datetime(ks.sample$deadline)
ks.sample$launched_at <- as_datetime(ks.sample$launched_at)
ks.sample$state_changed_at <- as_datetime(ks.sample$state_changed_at)

ks.sample$live_period <- as.integer(difftime(ks.sample$deadline, ks.sample$launched_at, units = "days"))
ks.sample$state_change_period <- as.integer(difftime(ks.sample$state_changed_at, ks.sample$launched_at, units = "days"))

ks.sample$country <- as.factor(ks.sample$country)
ks.sample$currency <- as.factor(ks.sample$currency)
ks.sample <- subset(ks.sample, ks.sample$state != "live")
ks.sample$state <- as.factor(ks.sample$state)


ks.sample$usd_goal <- ks.sample$goal*ks.sample$static_usd_rate
```

```{r}
ks.sample <- ks.sample[,-c(2,4,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,34,35,36,38)]
```

```{r}
summary(ks.sample)
write_csv(ks.sample, "ks.sample.clean.csv")
```

```{r}
kickstart$deadline <- as_datetime(kickstart$deadline)
kickstart$launched_at <- as_datetime(kickstart$launched_at)
kickstart$state_changed_at <- as_datetime(kickstart$state_changed_at)

kickstart$live_period <- as.integer(difftime(kickstart$deadline, kickstart$launched_at, units = "days"))
kickstart$state_change_period <- as.integer(difftime(kickstart$state_changed_at, kickstart$launched_at, units = "days"))

kickstart$country <- as.factor(kickstart$country)
kickstart$currency <- as.factor(kickstart$currency)
kickstart <- subset(kickstart, kickstart$state != "live")
kickstart$state <- as.factor(kickstart$state)


kickstart$usd_goal <- kickstart$goal*kickstart$static_usd_rate
```

```{r}
kickstart <- kickstart[,-c(2,4,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,34,35,36,38)]
```

```{r}
summary(kickstart)
write_csv(kickstart, "kickstarter.clean.csv")
```

```{r, message=FALSE,echo=FALSE,warning=FALSE}
kickstart <- read_csv("kickstarter.clean.csv")
```


```{r}
test <- lapply(kickstart$category, strsplit, ",")
n = length(test)
test.df = matrix(data = NA, nrow = n, ncol = 2)
test.matrix = matrix(data = NA, nrow = n, ncol = 2)
for (i in 1:n){
  test.df[i, 1] <- test[[i]][[1]][3]
  test.df[i, 2] <- test[[i]][[1]][6]
}
test.df <- as.data.frame(test.df)
names(test.df)[1] <- "Category"
names(test.df)[2] <- "Main.Category"

cat <- lapply(test.df$Category, strsplit, ":")
mcat <- lapply(test.df$Main.Category, strsplit, ":")
for (j in 1:n){
  test.matrix[j, 1] <- cat[[j]][[1]][2]
  test.matrix[j, 2] <- mcat[[j]][[1]][2]
}

test.df <- as.data.frame(test.matrix)
names(test.df)[1] <- "Category"
names(test.df)[2] <- "Main.Category"
category <- rep(1:n)
main.category <- rep(1:n)
for (k in 1:n){
  category[k] <- gsub('"', '', test.df$Category[k], fixed = TRUE)
  main.category[k] <- gsub('"', '', test.df$Main.Category[k], fixed = TRUE)
}
```

```{r}
kickstart$category <- category
kickstart$main.category <- main.category
kickstart$category <- as.factor(kickstart$category)
kickstart$main.category <- as.factor(kickstart$main.category)
```
```{r}
summary(kickstart)
```

```{r}
sum(kickstart$main.category == "{web")
```


